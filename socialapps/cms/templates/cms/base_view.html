{% extends "base.html" %}
{% load i18n %}
{% load socialapps_tags %}
{% load courses_tags %}
{% load cms_tags %}

{% block extra_css %}
	<link rel="stylesheet" href="{{ STATIC_URL }}css/buttons.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/cms.css">
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
	$(document).ready(function() {
		$('.collapse').collapse();
		var startOrder = endOrder = "";
		$("#children-list").tableDnD({
			onDragClass: 'onDrag',
			dragHandle: 'move-child',
			onDrop: function(table, row) {
				endOrder = $.tableDnD.serialize().replace(/children-list\[\]+=/g, '').split('&');
				actualRow = row.id
				if( endOrder !== startOrder) {
					for (var i = 0; i < endOrder.length; i++) {
						if (endOrder[i] === actualRow) {
							object = actualRow;
							if ( i > 0 ) {
								target = endOrder[i-1]
								position = 'right';
							} else {
								target = endOrder[i+1]
								position = 'left';
							}
						}
					}
					$.post('{% url base_sort object.get_absolute_url %}', 
						{ 
							'object' 	: object, 
							'target' 	: target,
							'position'	: position
						}, function(data) {
							console.log(data);
					});					
				}
			},
			onDragStart: function(table, row) {
				startOrder = $.tableDnD.serialize().replace(/children-list\[\]+=/g, '').split('&');
			}
		});
	});
</script>
{% endblock %}

{% block content_tabs %}
	{% get_content_parent object %}
	{% if content_parent.parent.portal_type == 'course' %}
		{% get_user_section content_parent.parent %}
		{% if section %}
			<ul id="nav-menu">
				<li class="tooltip"><h3><a href="{% url base_view section.get_absolute_url %}">{{ content_parent.parent.title }} - {{ section.title }}</a></h3></li>
	    	</ul>
	    {% else %}
		    <ul id="nav-menu">
				<li class="tooltip"><h3><a href="{% url base_view object.get_absolute_url %}">{{ object.parent.title }} </a></h3></li>
	    	</ul>
	    {% endif %}
	{% else %}
		{% if content_parent.parent.portal_type == 'space' %}
			<ul id="nav-menu">
	        	<li class="tooltip"><h3><a href="{% url base_view content_parent.parent.get_absolute_url %}">{{ content_parent.parent.title }}</a></h3></li>  
	    	</ul>
		{% else%}
			{% show_local_menu object 'resources' %}
		{% endif %}
	{% endif %}
{% endblock %}

{% block content %}
<div class="cms-breadcrumb">
	{% block cms_nav %}
		{% if ancestors|length == 0 %}
			<a href="/{{object.get_absolute_url}}" class="nextnav">{{object.title}}</a> <span class="current nextnav">{% trans "Homepage" %}</span>
		{% else %}
			{% for item in ancestors %}
				<a href="/{{item.get_absolute_url}}" class="nextnav">{{item}}</a> 
			{% endfor %}
			<span class="current nextnav">{{ object.title }}</span>
		{% endif %}
	{% endblock %}
</div>

<div class="row">
	<div class="span8">
		{% block content_left %}{% endblock %}
		{% if parent.portal_type == 'multipage' %}		
			<div class="cms-nav">
				{% with object.get_previous_sibling as previous %}
					{% if previous %}
						<a href="/{{ previous.get_absolute_url }}" class="prev">{{ previous }}</a>
					{% endif %}
				{% endwith %}
				{% with object.get_next_sibling as next %}
					{% if next %}
						<a href="/{{next.get_absolute_url }}" class="next">{{ next }}</a>
					{% endif %}
				{% endwith %}
			</div>		
		{% endif %}		
	</div>
	<div class="span4">
        <!-- <div class="tags-folder">{{object.tags}}</div> -->
		{% if parent.portal_type == 'multipage' %}
			<ul class="cms-toc">
				{% for item in parent.get_children %}
					{% if item.id == object.id %}
						<li class="current">
							<img src="{{ STATIC_URL }}images/cms-icons/{{item.portal_type}}.png" width="16" height="16">
							{{ item }}
						</li>
					{% else %}
						<li>
							<a href="/{{item.get_absolute_url}}">
								<img src="{{ STATIC_URL }}images/cms-icons/{{item.portal_type}}.png" width="16" height="16">
								{{ item }}
							</a>
						</li>
					{% endif %}
				{% endfor %}
			</ul>		
		{% endif %}
		{% ifhasperm edit object %}
			{% include "cms/cms_admin_menu.html" with object=object %}
        {% endifhasperm %}
		{% get_content_parent object %}
		{% if content_parent.parent.portal_type == 'course' %}
			{% load courses_tags %}
			{% get_user_section content_parent.parent %}
			{% show_navigation section %}
		{% else %}
			{% show_navigation object %}
		{% endif %}
		{% block content_right %}
		{% endblock %}
	</div>
</div>
{% endblock %}
